<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="generator" content="AsciiDoc 8.6.9">
<title>django-redis documentation</title>
<link rel="stylesheet" href="static/niwi.css" type="text/css">
<link rel="stylesheet" href="static/pygments.css" type="text/css">


<script type="text/javascript" src="static/asciidoc.js"></script>
<script type="text/javascript" src="static/niwi.js"></script>
<script type="text/javascript">
/*<![CDATA[*/
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article" style="max-width:800px">
<div id="header">
<h1>django-redis documentation</h1>
<span id="author">Andrey Antukh,</span><br>
<span id="email" class="monospaced">&lt;<a href="mailto:niwi@niwi.be">niwi@niwi.be</a>&gt;</span><br>
<span id="revnumber">version 3.5.2,</span>
<span id="revdate">2014-03-07</span>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph"><p><em>django-redis</em> is a <a href="#license">BSD Licensed</a>, full featured redis cache/session backend for Django.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_why_use_django_redis">2. Why use django-redis?</h2>
<div class="sectionbody">
<div class="paragraph"><p>Because it:</p></div>
<div class="ulist"><ul>
<li>
<p>
In active development
</p>
</li>
<li>
<p>
Modular client system (pluggable clients)
</p>
</li>
<li>
<p>
Master-Slave support on default client.
</p>
</li>
<li>
<p>
With complete battery of tests.
</p>
</li>
<li>
<p>
Used in production on several projects as cache and session storage.
</p>
</li>
<li>
<p>
Support infinite timeouts.
</p>
</li>
<li>
<p>
Python3 support in same code base.
</p>
</li>
<li>
<p>
Wide range of Django version support: 1.3-1.7
</p>
</li>
<li>
<p>
Facilities for raw access to redis client/connection pool.
</p>
</li>
<li>
<p>
Highly configurable (can emulate memcached exception behavior as example).
</p>
</li>
<li>
<p>
Unix sockets supported by default.
</p>
</li>
<li>
<p>
Plugable parsers.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_install">3. How to install?</h2>
<div class="sectionbody">
<div class="paragraph"><p>The simples way for get django-redis on your project is using <strong>pip</strong>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>pip install django-redis
</pre></div></div></div>
</div>
</div>
<div class="sect1">
<h2 id="_user_guide">4. User guide</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_configure_as_cache_backend">4.1. Configure as cache backend</h3>
<div class="paragraph"><p>For start using <strong>django-redis</strong>, you should change your django cache settings to something
like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">CACHES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;BACKEND&quot;</span><span class="p">:</span> <span class="s">&quot;redis_cache.cache.RedisCache&quot;</span><span class="p">,</span>
        <span class="s">&quot;LOCATION&quot;</span><span class="p">:</span> <span class="s">&quot;127.0.0.1:6379:1&quot;</span><span class="p">,</span>
        <span class="s">&quot;OPTIONS&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;CLIENT_CLASS&quot;</span><span class="p">:</span> <span class="s">&quot;redis_cache.client.DefaultClient&quot;</span><span class="p">,</span>
            <span class="s">&quot;PASSWORD&quot;</span><span class="p">:</span> <span class="s">&quot;secretpassword&quot;</span><span class="p">,</span> <span class="c"># Optional</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div></div>
<div class="paragraph"><p>On this example, we are using standard tcp/ip sockets connection to localhost redis and using database 1.
In <span class="monospaced">OPTIONS</span>, we have especified the plugable client that we want use; in this case the default. You can ommit
this part because that client is used by default if no one is specified.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">If you want use unix sockets, change the <span class="monospaced">LOCATION</span> value to something like <span class="monospaced">"unix:/path/to/socket:1"</span>.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_configure_as_session_backend">4.2. Configure as session backend</h3>
<div class="paragraph"><p>Django, by default can use any cache backend as session backend and you can take profit of it using <strong>django-redis</strong>
as backend for session storage whithout installing any additional and unnecesary backends:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">SESSION_ENGINE</span> <span class="o">=</span> <span class="s">&quot;django.contrib.sessions.backends.cache&quot;</span>
<span class="n">SESSION_CACHE_ALIAS</span> <span class="o">=</span> <span class="s">&quot;default&quot;</span>
</pre></div></div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced_usage">5. Advanced usage</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_pickle_version">5.1. Pickle version</h3>
<div class="paragraph"><p><strong>django-redis</strong> for al most all values uses pickle for serialize objects and it, by default uses the
last pickle protocol version, but if you want set a custom version you can do it with <strong>PICKLE_VERSION</strong> key
on <strong>OPTIONS</strong>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="s">&quot;OPTIONS&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">&quot;PICKLE_VERSION&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="c"># Use the last</span>
<span class="p">}</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_socket_timeout">5.2. Socket timeout</h3>
<div class="paragraph"><p>You can set socket timeout using <strong>SOCKET_TIMEOUT</strong> key on <strong>OPTIONS</strong> dict:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="s">&quot;OPTIONS&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">&quot;SOCKET_TIMEOUT&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="c"># in segons</span>
<span class="p">}</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_memcached_exceptions_behavior">5.3. Memcached exceptions behavior</h3>
<div class="paragraph"><p>In some situations, when redis is only used for cache you do not want exceptios when redis is down. This is
a default behavior with memcached backend and it can be emulated with <strong>django-redis</strong>.</p></div>
<div class="paragraph"><p>You can ignore exceptions globally (for all configured redis cache clients) setting <strong>DJANGO_REDIS_IGNORE_EXCEPTIONS</strong>
to <span class="monospaced">True</span> in your settings.</p></div>
<div class="paragraph"><p>Additionally, you can set it individually for each client on their <strong>OPTIONS</strong> dict:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="s">&quot;OPTIONS&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">&quot;IGNORE_EXCEPTIONS&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
<span class="p">}</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_infinite_timeout">5.4. Infinite timeout</h3>
<div class="paragraph"><p><strong>django-redis</strong> comes with infinite timeouts support from before django has added it (with django 1.6 version).</p></div>
<div class="paragraph"><p>Before django 1.6, django-redis interprets 0 timeout value as infinite value and with django&gt;=1.6 it also supports
<span class="monospaced">None</span> as timeout value.</p></div>
<div class="listingblock">
<div class="title">This statements now are equivalent</div>
<div class="content"><div class="highlight"><pre><span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_additional_methods">5.5. Additional methods</h3>
<div class="paragraph"><p><strong>django-redis</strong> comes with some additions to the default django backend interface with two new methods:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">keys(wildcard_pattern)</span>: Retrieve keys matching glob pattern.
</p>
</li>
<li>
<p>
<span class="monospaced">delete_pattern(wildcard_pattern)</span>: Remove keys matching glob pattern.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Example use of keys</div>
<div class="content"><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">django.core.cache</span> <span class="kn">import</span> <span class="n">cache</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cache</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="s">&quot;foo_*&quot;</span><span class="p">)</span>
<span class="p">[</span><span class="s">&quot;value1&quot;</span><span class="p">,</span> <span class="s">&quot;value2&quot;</span><span class="p">]</span>
</pre></div></div></div>
<div class="listingblock">
<div class="title">Example use of delete_pattern</div>
<div class="content"><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">django.core.cache</span> <span class="kn">import</span> <span class="n">cache</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cache</span><span class="o">.</span><span class="n">delete_pattern</span><span class="p">(</span><span class="s">&quot;foo_*&quot;</span><span class="p">)</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_redis_native_commands">5.6. Redis native commands</h3>
<div class="paragraph"><p><strong>django-redis</strong> has limited support for some redis atomic operations, such as commands <span class="monospaced">setnx</span> and <span class="monospaced">inc</span>.</p></div>
<div class="paragraph"><p>You can use <strong>setnx</strong> command with backend <span class="monospaced">set()</span> method with <span class="monospaced">nx</span> parameter:</p></div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content"><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">django.core.cache</span> <span class="kn">import</span> <span class="n">cache</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;key&quot;</span><span class="p">,</span> <span class="s">&quot;value1&quot;</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;key&quot;</span><span class="p">,</span> <span class="s">&quot;value2&quot;</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="bp">False</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;key&quot;</span><span class="p">)</span>
<span class="s">&quot;value1&quot;</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_raw_client_access">5.7. Raw client access</h3>
<div class="paragraph"><p>In some situations, your application should require access to raw redis client for use some other advanced
features that aren&#8217;t exposed by django cache interface. For avoid store an other settings for creating a raw
connection, <strong>django-redis</strong> exposes functions with that you can obtain a raw client reusing cache connection
string: <span class="monospaced">get_redis_connection(alias)</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">redis_cache</span> <span class="kn">import</span> <span class="n">get_redis_connection</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">con</span> <span class="o">=</span> <span class="n">get_redis_connection</span><span class="p">(</span><span class="s">&#39;default&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">con</span>
<span class="o">&lt;</span><span class="n">redis</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">Redis</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x2dc4510</span><span class="o">&gt;</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">Not all plugable clients have support this feature.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_plugable_parsers">5.8. Plugable parsers</h3>
<div class="paragraph"><p>redis-py (python redis client used by django-redis) comes with pure python redis parser that works very
well for al most common task, but if you want some performance boost, you can use <strong>hiredis</strong>.</p></div>
<div class="paragraph"><p><strong>hiredis</strong> is a redis client writen in C and it has it own parser that can be used with <strong>django-redis</strong>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="s">&quot;OPTIONS&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">&quot;PARSER_CLASS&quot;</span><span class="p">:</span> <span class="s">&quot;redis.connection.HiredisParser&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_pluggable_clients">5.9. Pluggable clients</h3>
<div class="sect3">
<h4 id="_default_client">5.9.1. Default client</h4>
<div class="paragraph"><p>Additionally to previously explained, default client comes with master-slave connection support. For
use master-slave configuration on your project, you should change you <strong>LOCATION</strong> value to something like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="s">&quot;LOCATION&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s">&quot;127.0.0.1:6379:1&quot;</span><span class="p">,</span>
    <span class="s">&quot;127.0.0.1:6378:1&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">Master-Slave setup is not heavily tested on production environments.</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="_shard_client">5.9.2. Shard client</h4>
<div class="paragraph"><p>This plugable client implements client-side sharding. It inherits almost all functionality from
the default client. For use it, you change your cache settings to something like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">CACHES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;BACKEND&quot;</span><span class="p">:</span> <span class="s">&quot;redis_cache.cache.RedisCache&quot;</span><span class="p">,</span>
        <span class="s">&quot;LOCATION&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s">&quot;127.0.0.1:6379:1&quot;</span><span class="p">,</span>
            <span class="s">&quot;127.0.0.1:6379:2&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s">&quot;OPTIONS&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;CLIENT_CLASS&quot;</span><span class="p">:</span> <span class="s">&quot;redis_cache.client.ShardClient&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">shard client is still experimental and be careful when using it on production environments.</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="_herd_client">5.9.3. Herd client</h4>
<div class="paragraph"><p>This plugable client helps with dealing with thundering herd problem. You can read more about it
on <a href="http://en.wikipedia.org/wiki/Thundering_herd_problem">Wikipedia</a>.</p></div>
<div class="paragraph"><p>As previous plugable client, it inherits all functionality from default client, adding some additional
login for get/set keys.</p></div>
<div class="listingblock">
<div class="title">Example setup</div>
<div class="content"><div class="highlight"><pre> <span class="n">CACHES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;BACKEND&quot;</span><span class="p">:</span> <span class="s">&quot;redis_cache.cache.RedisCache&quot;</span><span class="p">,</span>
        <span class="s">&quot;LOCATION&quot;</span><span class="p">:</span> <span class="s">&quot;127.0.0.1:6379:1&quot;</span><span class="p">,</span>
        <span class="s">&quot;OPTIONS&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;CLIENT_CLASS&quot;</span><span class="p">:</span> <span class="s">&quot;redis_cache.client.HerdClient&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div></div>
<div class="paragraph"><p>This client, exposes additional settings:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>CACHE_HERD_TIMEOUT</strong>: Set default herd timeout. (default value: 60s)
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_auto_failover_client">5.9.4. Auto Failover client</h4>
<div class="paragraph"><p>This plugable experimental client offers simple failover algorithm if the main redis server turns down.</p></div>
<div class="paragraph"><p>For setup, you should change your cache settings to somethin like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">CACHES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;BACKEND&quot;</span><span class="p">:</span> <span class="s">&quot;redis_cache.cache.RedisCache&quot;</span><span class="p">,</span>
        <span class="s">&quot;LOCATION&quot;</span><span class="p">:</span> <span class="s">&quot;127.0.0.1:6379:1/127.0.0.2:6379:1&quot;</span><span class="p">,</span>
        <span class="s">&quot;OPTIONS&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;CLIENT_CLASS&quot;</span><span class="p">:</span> <span class="s">&quot;redis_cache.client.SimpleFailoverClient&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The big difference is that each key on <strong>LOCATION</strong> setting list can contain two connection strings
separated by "/". A second connection strings works as failover server.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="license">6. License</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content"><div class="highlight"><pre>Copyright (c) 2011-2014 Andrei Antoukh &lt;niwi@niwi.be&gt;
Copyright (c) 2011 Sean Bleier

All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions
are met:
1. Redistributions of source code must retain the above copyright
   notice, this list of conditions and the following disclaimer.
2. Redistributions in binary form must reproduce the above copyright
   notice, this list of conditions and the following disclaimer in the
   documentation and/or other materials provided with the distribution.
3. The name of the author may not be used to endorse or promote products
   derived from this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS&#39;&#39; AND ANY EXPRESS OR
IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
</pre></div></div></div>
</div>
</div>
</div>
<div id="footnotes"><hr></div>
<div id="footer">
<div id="footer-text">
Version 3.5.2<br>
Last updated 2014-03-07 21:17:54 CET
</div>
</div>
</body>
</html>
